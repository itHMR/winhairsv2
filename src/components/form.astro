---
import "../styles/global.css";
---
<section id="aboutUs" data-header-color="#91C1C1" data-header-logo="1" class="bg-white h-screen w-screen relative flex justify-center flex-col px-6 py-10 sm:px-10 lg:px-6 xl:px-16 2xl:px-44 md:py-14 xl:py-24">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 xl:gap-10 mt-10 sm:mt-20">
        
        <!-- Formulario -->

           <div data-animation="animate__pulse" class="animate__animated flex flex-col">
            <div style="width: 100%; max-width: 800px; margin: 0 auto; padding: 0;">
                <iframe
                    id="hmr-form-iframe"
                    src="https://erp.winhairs.com/iframe-form/eyJpdiI6IjRBSWQyZytPNTRmMkxCTDdVOWtIVmc9PSIsInZhbHVlIjoiMlBwT1VNQzI1TTR3YkxQaG1MRlhnZz09IiwibWFjIjoiOWI5YTI3NDcwMDBiZmM5YThmM2RlMzUyMDJhYjdkZDdlNGQyMzQ3ZjFlNzNlMTE1YjhmOGU4MWE2ZmNmMGVmMCIsInRhZyI6IiJ9"
                    frameborder="0"
                    width="100%"
                    height="100%"
                    style="
                    min-height: 600px;
                    width: 100%;
                    border: none;
                    display: block;
                    "
                ></iframe>
            </div>
            <!--<h2 class="text-2xl sm:text-3xl lg:text-4xl xl:text-5xl font-[Poppins] font-light mb-0 sm:mb-4 xl:mb-6 text-[#376374]">We’ll contact you!</h2>
            
            <form method="POST">
                <p class="mb-4 text-gray-600 text-xs sm:text-sm font-normal">
                    Fields marked with an asterisk <span class="text-red-600">*</span> are required.
                </p>
                
                <div class="grid md:grid-cols-2 grid-cols-1 gap-x-6">
                    <div class="relative mb-2 md:mb-4 xl:mb-6">
                        <label class="flex items-center font-[Poppins] mb-2 text-[#376374] text-sm">First Name <svg width="7" height="7" class="ml-1" viewBox="0 0 7 7" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M3.11222 6.04545L3.20668 3.94744L1.43679 5.08594L0.894886 4.14134L2.77415 3.18182L0.894886 2.2223L1.43679 1.2777L3.20668 2.41619L3.11222 0.318182H4.19105L4.09659 2.41619L5.86648 1.2777L6.40838 2.2223L4.52912 3.18182L6.40838 4.14134L5.86648 5.08594L4.09659 3.94744L4.19105 6.04545H3.11222Z" fill="#EF4444" />
                            </svg>
                        </label>
                        <input autocomplete="off" id="first-name" name="first-name" type="text" class="block w-full h-8 xl:h-10 px-3 xl:px-4 py-2 xl:py-2.5 text-sm xl:text-base border border-gray-300 focus:outline-none focus:border-[#376374] focus:border-2 rounded-md">
                    </div>
                    <div class="relative mb-2 md:mb-4 xl:mb-6">
                        <label class="flex items-center font-[Poppins] mb-2 text-[#376374] text-sm">Last Name <svg width="7" height="7" class="ml-1" viewBox="0 0 7 7" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M3.11222 6.04545L3.20668 3.94744L1.43679 5.08594L0.894886 4.14134L2.77415 3.18182L0.894886 2.2223L1.43679 1.2777L3.20668 2.41619L3.11222 0.318182H4.19105L4.09659 2.41619L5.86648 1.2777L6.40838 2.2223L4.52912 3.18182L6.40838 4.14134L5.86648 5.08594L4.09659 3.94744L4.19105 6.04545H3.11222Z" fill="#EF4444" />
                            </svg>
                        </label>
                        <input autocomplete="off" id="last-name" name="last-name" type="text" class="block w-full h-8 xl:h-10 px-3 xl:px-4 py-2 xl:py-2.5 text-sm xl:text-base border border-gray-300 focus:outline-none focus:border-[#376374] focus:border-2 rounded-md">
                    </div>
                </div>
                
                <div class="relative mb-2 md:mb-4 xl:mb-6">
                    <label class="flex items-center font-[Poppins] mb-2 text-[#376374] text-sm">Email <svg width="7" height="7" class="ml-1" viewBox="0 0 7 7" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M3.11222 6.04545L3.20668 3.94744L1.43679 5.08594L0.894886 4.14134L2.77415 3.18182L0.894886 2.2223L1.43679 1.2777L3.20668 2.41619L3.11222 0.318182H4.19105L4.09659 2.41619L5.86648 1.2777L6.40838 2.2223L4.52912 3.18182L6.40838 4.14134L5.86648 5.08594L4.09659 3.94744L4.19105 6.04545H3.11222Z" fill="#EF4444" />
                            </svg>
                    </label>
                    <input autocomplete="off" id="email" name="email" type="email" class="block w-full h-8 xl:h-10 px-3 xl:px-4 py-2 xl:py-2.5 text-sm xl:text-base border border-gray-300 focus:outline-none focus:border-[#376374] focus:border-2 rounded-md">
                </div>
                
                <div class="relative mb-2 md:mb-4 xl:mb-6">
                    <label class="flex items-center font-[Poppins] mb-2 text-[#376374] text-sm">Age <svg width="7" height="7" class="ml-1" viewBox="0 0 7 7" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M3.11222 6.04545L3.20668 3.94744L1.43679 5.08594L0.894886 4.14134L2.77415 3.18182L0.894886 2.2223L1.43679 1.2777L3.20668 2.41619L3.11222 0.318182H4.19105L4.09659 2.41619L5.86648 1.2777L6.40838 2.2223L4.52912 3.18182L6.40838 4.14134L5.86648 5.08594L4.09659 3.94744L4.19105 6.04545H3.11222Z" fill="#EF4444" />
                            </svg>
                    </label>
                    <input autocomplete="off" id="age" name="age" type="number" class="block w-full h-8 xl:h-10 px-3 xl:px-4 py-2 xl:py-2.5 text-sm xl:text-base border border-gray-300 focus:outline-none focus:border-[#376374] focus:border-2 rounded-md">
                </div>

                <div style="display:none;">
                    <label for="website">Website</label>
                    <input type="text" id="website" name="website" autocomplete="off">
                </div>
                
                <div class="relative mb-5">
                    <label class="flex items-center font-[Poppins] mb-2 text-[#376374] text-sm">Message <svg width="7" height="7" class="ml-1" viewBox="0 0 7 7" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M3.11222 6.04545L3.20668 3.94744L1.43679 5.08594L0.894886 4.14134L2.77415 3.18182L0.894886 2.2223L1.43679 1.2777L3.20668 2.41619L3.11222 0.318182H4.19105L4.09659 2.41619L5.86648 1.2777L6.40838 2.2223L4.52912 3.18182L6.40838 4.14134L5.86648 5.08594L4.09659 3.94744L4.19105 6.04545H3.11222Z" fill="#EF4444" />
                            </svg>
                    </label>
                    <textarea id="message" name="message" class="block w-full h-16 md:h-26 xl:h-36 px-4 py-2.5 text-sm xl:text-base border border-gray-300 rounded-2xl focus:outline-none resize-none"></textarea>
                </div>
                
                <button id="submit-btn" class="w-full cursor-pointer py-4 px-4 text-sm bg-[#376374] text-white rounded-lg font-semibold shadow-md transition-all duration-500 hover:bg-[#547785]">
                    Send
                </button>
            </form>-->
        </div> 
        
        <!-- Mapa -->
        <div data-animation="animate__pulse" class="animate__animated hidden md:flex flex-col">
            <h2 class="text-2xl sm:text-3xl lg:text-3xl xl:text-5xl font-[Poppins] font-light mb-4 xl:mb-6 text-[#376374]">Plan your trip to Tijuana.</h2>
            <p class="font-[Poppins] mb-4 xl:mb-6 text-sm xl:text-lg font-light text-gray-800">
                Located only 10 minutes away from the San Ysidro Border Crossing, to make your trip even easier.
            </p>
            
            <div class="w-full h-72 sm:h-96 md:h-full">
                <iframe class="w-full h-full rounded-lg shadow-md" frameborder="0" scrolling="no" 
                        src="https://maps.google.com/maps?width=500&amp;height=500&amp;hl=en&amp;q=Av. Diego Rivera 2339, Zona Urbana Rio Tijuana, 22010 Tijuana, B.C.&amp;t=&amp;z=15&amp;ie=UTF8&amp;iwloc=B&amp;output=embed">
                </iframe>
            </div>
        </div>
    </div>
</section>
<script>
    const form = document.querySelector('form');
    const expresiones = {
        name: /^[a-zA-ZÀ-ÿ\s]{3,40}$/, // Letras y espacios, pueden llevar acentos.
        email: /^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/,
        age: /^\d{1,2}$/, // solo 2 numeros.
    }

    form.addEventListener('submit', (e) => {
        e.preventDefault();

        let first_name = document.querySelector("#first-name");
        let last_name = document.querySelector("#last-name");
        let email = document.querySelector("#email");
        let age = document.querySelector("#age");
        let message = document.querySelector("#message");
        let website = document.querySelector("#website");

        if(message.value.trim() === '')
        {
            message.classList.add('error');
        }
        else
        {
            message.classList.remove('error');
        }

        if(age.value.trim() === '')
        {
            age.classList.add('error');
        }
        else
        {
            age.classList.remove('error');
        }

        if (expresiones.name.test(first_name.value) == false) 
        {
            first_name.classList.add('error');
        }
        else
        {
            first_name.classList.remove('error');
        }

        if (expresiones.name.test(last_name.value) == false) 
        {
            last_name.classList.add('error');
        }
        else
        {
            last_name.classList.remove('error');
        }

        if (expresiones.email.test(email.value) == false) 
        {
            email.classList.add('error');
        }
        else
        {
            email.classList.remove('error');
        }

        if(website.value.trim() === '')
        {
            if(expresiones.name.test(first_name.value) && expresiones.name.test(last_name.value) && expresiones.email.test(email.value) && expresiones.age.test(age.value) && message.value.trim() !== '')
            {
                const formData = new FormData(form);
                //console.log(Object.fromEntries(formData.entries()));
                fetchValidation('../form/form.php', formData);
            }
            else
            {
                Swal.fire({
                    title: "Oops! 😅",
                    text: "Looks like some fields are incomplete or incorrect. Could you fix them before submitting?",
                    icon: "info",
                    confirmButtonText: "Sure!"
                });
            }
        }
    })

    function fetchValidation(url, formData){
        const submitBtn = document.getElementById('submit-btn');

        // Deshabilitar botón y mostrar loader
        if (submitBtn.disabled) return;
        submitBtn.disabled = true;
        
        submitBtn.value = 'Sending...';

        Swal.fire({
            title: 'Sending message...',
            text: 'Please wait a moment ⏳',
            allowOutsideClick: false,
            allowEscapeKey: false,
            didOpen: () => {
                Swal.showLoading();
            }
        });

        /*const timeoutId = setTimeout(() => {
            Swal.fire({
                title: "All done! 🎉",
                text: "Your message is on its way. Thanks for reaching out!",
                icon: "success",
                confirmButtonText: "Awesome!"
            });
            form.reset();
        }, 5000); // Schedule for 5 seconds*/

        fetch(url, {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            console.log(data); // ✅ ahora sí se debería ver el JSON bien
            if (data.status) 
            {
                Swal.fire({
                    icon: 'success',
                    title: data.message,
                });

                // Resetear el formulario
                form.reset();
            } 
            else 
            {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: data.message,
                });
            }
        })
        .catch(error => {
            Swal.fire({
                icon: 'error',
                title: 'Oops...',
                text: error.message,
            })
        })
        .finally(() => {
            // Rehabilitar el botón
            submitBtn.disabled = false;
            submitBtn.value = 'Send Message';
        });
    }
</script>